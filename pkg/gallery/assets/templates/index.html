<header class="gallery-header">
    <h1 class="gallery-title">{{.Gallery.Title}}</h1>
    {{if .Gallery.Description}}
    <p class="gallery-description">{{.Gallery.Description}}</p>
    {{end}}
</header>

<div class="masonry-grid" id="albums-grid">
    <div class="grid-sizer"></div>
    {{range .Gallery.Albums}}
    <div class="grid-item album-card" data-album-id="{{.ID}}">
        <a href="{{.ID}}/index.html" class="album-link">
            <div class="album-cover">
                {{if .Photos}}
                {{$album := .}}
                {{$coverPhoto := ""}}
                {{if $album.CoverPhoto}}
                    {{range $album.Photos}}
                        {{if eq .Filename $album.CoverPhoto}}
                            {{$coverPhoto = .}}
                        {{end}}
                    {{end}}
                {{end}}
                {{if not $coverPhoto}}
                    {{$coverPhoto = index $album.Photos 0}}
                {{end}}
                {{with $coverPhoto}}
                {{if index .Thumbnails "medium"}}
                <img src=".{{index .Thumbnails "medium"}}" 
                     alt="{{$album.Title}}" 
                     loading="lazy"
                     onerror="this.style.display='none'; this.parentElement.classList.add('no-image');">
                {{else if index .Thumbnails "small"}}
                <img src=".{{index .Thumbnails "small"}}" 
                     alt="{{$album.Title}}" 
                     loading="lazy"
                     onerror="this.style.display='none'; this.parentElement.classList.add('no-image');">
                {{else if .IsVideo}}
                    {{if index .Thumbnails "poster"}}
                    <img src=".{{index .Thumbnails "poster"}}" 
                         alt="{{$album.Title}}" 
                         loading="lazy"
                         onerror="this.style.display='none'; this.parentElement.classList.add('no-image');">
                    {{end}}
                {{end}}
                {{end}}
                {{end}}
                <div class="album-info-overlay">
                    <h2 class="album-title">{{.Title}}</h2>
                    <div class="album-count">{{len .Photos}} {{if eq (len .Photos) 1}}photo{{else}}photos{{end}}</div>
                </div>
            </div>
        </a>
    </div>
    {{end}}
</div>